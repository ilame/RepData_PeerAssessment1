---
title: "Reproducible Research Peer Assessment 1"
output: html_document
---

##Loading and preprocessing the data


```{r}
#Load required libraries
#library(knitr)
#opts_chunk$set(echo = TRUE, results = 'hold')

library(data.table)
library(ggplot2)

#Load the data
rdata <- read.csv("activity.csv", colClasses = c("numeric","character","numeric"))

#check the head of the file
head(rdata)

#preprocess the data: We convert the date field to Date class and interval field to Factor class.

rdata$date <- as.Date(rdata$date, format = "%Y-%m-%d")
#rdata$interval <- as.factor(rdata$interval)

#Now, we check the data using str() method

str(rdata)


```

##What is mean total number of steps taken per day?

For this part of the assignment, we can ignore the missing values in the dataset.

``` {r}
# We calculate the total number of steps taken per day
steps_per_day <- aggregate(steps ~ date, rdata, "sum")

# à verifier plus tard
#colnames(steps_per_day) <- c("date","steps")
head(steps_per_day)

```

We make a histogram of the total number of steps taken each day

```{r, echo=FALSE}

hist(steps_per_day$steps,col="red", main="Total Steps Taken Each Day",xlab="Total steps per day")

```

``` {r}

#We calculate and report the mean and median of the total number of steps taken per day
steps_mean   <- mean(steps_per_day$steps, na.rm=TRUE)
steps_median <- median(steps_per_day$steps, na.rm=TRUE)

```

The mean is `r steps_mean`  and median is `r steps_median`.

##What is the average daily activity pattern?

``` {r}
#We calculate the aggregation of steps by intervals of 5-minutes and convert the intervals as integers and save them in a data frame called steps_per_interval.
steps_per_interval <- aggregate(steps ~ interval, rdata, "mean",na.rm=TRUE)

#We convert to integers. This helps in plotting
#steps_per_interval$interval <- 
        #as.integer(levels(steps_per_interval$interval)[steps_per_interval$interval#])
#colnames(steps_per_interval) <- c("interval", "steps")

```

We make a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r, echo=FALSE}

plot(steps_per_interval$interval, steps_per_interval$steps, type="l", xlab="5-min interval", ylab="Average across all days",main="Average number of steps taken",col="red")

## or (à choisir plus tard)

ggplot(steps_per_interval, aes(x=interval, y=steps)) +   
        geom_line(color="orange", size=1) +  
        labs(title="Average Daily Activity Pattern", x="Interval", y="Number of steps") +  
        theme_bw()

```

Now, we find the 5-minute interval wich contains the maximum number of steps:

``` {r}
max_steps <- which.max(steps_per_interval$steps)

# get the interval with maximum average number of steps 
steps_per_interval[max_steps, ]

```
The interval 835 has the maximum average of steps `r max_steps`.
        
##Imputing missing values  

We calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)

``` {r}

activity_NA <-sum(is.na(rdata$steps))
```
The total number of missing values are `r activity_NA`.

Strategy for filling in all of the missing values in the dataset and creation of a new dataset that is equal to the original dataset but with the missing data filled in.

``` {r}

new_rdata<-rdata

#To populate missing values, we choose to replace them with the mean value at the same interval across days.

#We loop across the rows of the data frame "new_rdata". If the steps value is NA for a row, we find the corresponding value of interval. We then look up the steps value from the other data frame "steps_per_interval" for this value of interval and replace the NA value with it.

for (i in 1:nrow(new_rdata)){
  if (is.na(new_rdata$steps[i])){
    interval_val <- new_rdata$interval[i]
    row_id <- which(steps_per_interval$interval == interval_val)
    steps_val <- steps_per_interval$steps[row_id]
    new_rdata$steps[i] <- steps_val
  }
}

#aggregate steps as per date to get total number of steps in a day
steps_per_day_imputed <- aggregate(steps ~ date, new_rdata, sum)

```

We create a histogram of total number of steps in a day
```{r, echo=FALSE}

hist(steps_per_day_imputed$steps, col=1, main="(Imputed) Histogram of total number of steps per day", xlab="Total number of steps in a day")
```

We calculate and report the mean and median total number of steps taken per day. 


``` {r}
steps_mean_imputed   <- mean(steps_per_day_imputed$steps)
steps_median_imputed <- median(steps_per_day_imputed$steps)

```
The new mean is `r steps_mean_imputed`  and the new median is `r steps_median_imputed`.

Do these values differ from the estimates from the first part of the assignment? 

Before imputation, the mean  was `r steps_mean`  and the median was `r steps_median`.

Due to data imputation, the mean remain same whereas there is slight change in the median value.


What is the impact of imputing missing data on the estimates of the total daily number of steps?

As you can see, comparing with the calculations done in the first section of this document, we observe that while the mean value remains unchanged, the median value has shifted and virtual matches to the mean.

Since our data has shown a t-student distribution (see both histograms), it seems that the impact of imputing missing values has increase our peak, but it's not affect negatively our predictions.

##Are there differences in activity patterns between weekdays and weekends?

Use the dataset with the filled-in missing values for this part.

Create a new factor variable in the dataset with two levels - "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.



```{r}
#Sys.setlocale("LC_TIME", "en_US")
new_rdata$date <- as.Date(new_rdata$date, format = "%Y-%m-%d")
new_rdata$day <- weekdays(new_rdata$date)
new_rdata$day_type <- c("weekday")

for (i in 1:nrow(new_rdata)){
  if (new_rdata$day[i] == "Samedi" || new_rdata$day[i] == "dimanche"){
    new_rdata$day_type[i] <- "weekend"
  }
}

# convert day_time from character to factor
new_rdata$day_type <- as.factor(new_rdata$day_type)

# aggregate steps as interval to get average number of steps in an interval across all days
interval_steps_imputed <- aggregate(steps ~ interval+day_type, new_rdata, "mean")

#interval_steps_imputed$interval <- as.numeric(as.character(interval_steps_imputed$interval))
```    

We make a panel plot containing a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis).

```{r, echo=FALSE}

qplot(interval, steps, data=interval_steps_imputed, geom=c("line"), xlab="Interval", ylab="Number of steps", main="") + 
  facet_wrap(~ day_type, ncol=1)


```


ggplot(interval_steps_imputed, aes(x=interval, y=steps)) + 
        geom_line(color="violet",aes(group=interval)) + 
        facet_wrap(~ day_type, nrow=2, ncol=1) +
        labs(x="Interval", y="Number of steps") +
        theme_bw()